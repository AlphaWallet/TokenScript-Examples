<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/strict.dtd">
<html xmlns="http://www.w3.org/TR/xhtml1/strict">
<head>
    <title>Playground</title>
    <script type="text/javascript">

        function doSomethingWithTheContract(pathContractJSON, strAddr, callback) {
            this.strAddr = strAddr;
            this.callback = callback;

            fetch(pathContractJSON)
                .then(
                    response => {
                        if (response.status !== 200) {
                            console.log('Looks like there was a problem. Status Code: ' +
                                response.status);
                            return;
                        }
                        // Examine the text in the response
                        response.json().then(jsonContract => {
                            console.log("Number of functions:" + jsonContract.abi.length);
                            const contract = web3.eth.contract(jsonContract.abi).at(this.strAddr);
                            this.callback(contract);
                        });
                    }
                )
                .catch(function (err) {
                    console.log('Fetch Error :-S', err);
                });
        }

        doSomethingWithTheContract('aave-protocol/build/contracts/LendingPool.json', '0x398eC7346DcD622eDc5ae82352F02bE94C62d119', contract => {
            contract.getUserReserveData('0x6B175474E89094C44Da98b954EedeAC495271d0F','0x147615dceb7aac2e7389037300b65e99b3b94f96', (error, result) => {
                if (!error) {
                    console.log(result[0].div(1e18, 10).toNumber());
                    console.log(result[1].div(1e18, 10).toNumber());
                    console.log(result[2].div(1e18, 10).toNumber());
                    console.log(result);
                } else
                    console.error(error);
            });
        });


        /* ------------- getReserveData ------------- */
        /* for some strange reasons, the following doesn't work (TypeError: getReserveConfigurationData is not a function )
        doSomethingWithTheContract('aave-protocol/build/contracts/LendingPool.json', 'â€‹0x398eC7346DcD622eDc5ae82352F02bE94C62d119', contract => {
            contract.getReserveConfigurationData('0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE', (error, result) => {
                if (!error)
                    console.log(result);
                else
                    console.error(error);
            });
        });
        */

        // so I had to do it without using doSomethingWithTheContract
        var LendingPool;
        fetch('aave-protocol/build/contracts/LendingPool.json')
            .then(
                function (response) {
                    if (response.status !== 200) {
                        console.log('Looks like there was a problem. Status Code: ' +
                            response.status);
                        return;
                    }

                    // Examine the text in the response
                    response.json().then(function (contract) {
                        LendingPool = web3.eth.contract(contract.abi).at('0x398eC7346DcD622eDc5ae82352F02bE94C62d119');
                        LendingPool.getReserveConfigurationData('0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE', (error, result) => {
                            if (!error) {
                                console.log("LendingPool.getReserveConfigurationData");
                                console.log(result);
                            } else
                                console.error(error);
                        });
                    });
                }
            )
            .catch(function (err) {
                console.log('Fetch Error :-S', err);
            });
    </script>
</head>
<body id="content">
</body>
</html>
